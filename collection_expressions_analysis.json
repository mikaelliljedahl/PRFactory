{
  "summary": {
    "scan_date": "2025-11-12",
    "total_findings": 56,
    "files_affected": 23,
    "estimated_total_token_savings": 642,
    "modernization_complexity": "Medium",
    "manual_review_required": 8
  },
  "by_pattern_type": {
    "list_initialization": {
      "count": 24,
      "description": "new List<T> { ... } patterns",
      "avg_tokens_per_item": 10,
      "findings": [
        {
          "file": "/home/user/PRFactory/src/PRFactory.Infrastructure/Application/LlmProviderFactory.cs",
          "line": 103,
          "pattern_type": "list-init",
          "current": "new List<string> { AnthropicProviderName, \"google\", \"openai\" }",
          "suggested": "[AnthropicProviderName, \"google\", \"openai\"]",
          "tokens_saved": 10,
          "risk": "low"
        },
        {
          "file": "/home/user/PRFactory/src/PRFactory.Infrastructure/Agents/Adapters/ClaudeCodeCliLlmProvider.cs",
          "line": 72,
          "pattern_type": "list-init",
          "current": "new List<string> { \"--headless\", \"--prompt\", prompt }",
          "suggested": "[\"--headless\", \"--prompt\", prompt]",
          "tokens_saved": 10,
          "risk": "low"
        },
        {
          "file": "/home/user/PRFactory/src/PRFactory.Infrastructure/Agents/Adapters/ClaudeCodeCliLlmProvider.cs",
          "line": 114,
          "pattern_type": "list-init",
          "current": "new List<string> { \"--headless\", \"--prompt\", prompt }",
          "suggested": "[\"--headless\", \"--prompt\", prompt]",
          "tokens_saved": 10,
          "risk": "low"
        },
        {
          "file": "/home/user/PRFactory/src/PRFactory.Domain/ValueObjects/CliAgentCapabilities.cs",
          "line": 85,
          "pattern_type": "list-init",
          "current": "new List<string> { \"json\", \"markdown\", \"text\" }",
          "suggested": "[\"json\", \"markdown\", \"text\"]",
          "tokens_saved": 10,
          "risk": "low"
        },
        {
          "file": "/home/user/PRFactory/src/PRFactory.Domain/ValueObjects/CliAgentCapabilities.cs",
          "line": 102,
          "pattern_type": "list-init",
          "current": "new List<string> { \"json\", \"text\" }",
          "suggested": "[\"json\", \"text\"]",
          "tokens_saved": 9,
          "risk": "low"
        },
        {
          "file": "/home/user/PRFactory/src/PRFactory.Domain/ValueObjects/CliAgentCapabilities.cs",
          "line": 68,
          "pattern_type": "list-init-coalesce",
          "current": "supportedFormats ?? new List<string>()",
          "suggested": "supportedFormats ?? []",
          "tokens_saved": 8,
          "risk": "low",
          "note": "Empty list initialization - most straightforward conversion"
        },
        {
          "file": "/home/user/PRFactory/src/PRFactory.Infrastructure/Agents/Graphs/AgentExecutionException.cs",
          "line": 70,
          "pattern_type": "list-init",
          "current": "new List<string> { base.ToString() }",
          "suggested": "[base.ToString()]",
          "tokens_saved": 10,
          "risk": "low"
        },
        {
          "file": "/home/user/PRFactory/src/PRFactory.Domain/Entities/User.cs",
          "line": 98,
          "pattern_type": "list-init-field",
          "current": "public ICollection<PlanReview> PlanReviews { get; private set; } = new List<PlanReview>();",
          "suggested": "public ICollection<PlanReview> PlanReviews { get; private set; } = [];",
          "tokens_saved": 8,
          "risk": "medium",
          "note": "Field initialization - requires explicit type from property declaration"
        },
        {
          "file": "/home/user/PRFactory/src/PRFactory.Domain/Entities/User.cs",
          "line": 99,
          "pattern_type": "list-init-field",
          "current": "public ICollection<ReviewComment> Comments { get; private set; } = new List<ReviewComment>();",
          "suggested": "public ICollection<ReviewComment> Comments { get; private set; } = [];",
          "tokens_saved": 8,
          "risk": "medium",
          "note": "Field initialization - requires explicit type from property declaration"
        },
        {
          "file": "/home/user/PRFactory/src/PRFactory.Domain/Entities/ReviewComment.cs",
          "line": 63,
          "pattern_type": "list-init-coalesce",
          "current": "mentionedUserIds ?? new List<Guid>()",
          "suggested": "mentionedUserIds ?? []",
          "tokens_saved": 8,
          "risk": "low"
        },
        {
          "file": "/home/user/PRFactory/src/PRFactory.Domain/Entities/ReviewComment.cs",
          "line": 76,
          "pattern_type": "list-init-coalesce",
          "current": "mentionedUserIds ?? new List<Guid>()",
          "suggested": "mentionedUserIds ?? []",
          "tokens_saved": 8,
          "risk": "low"
        },
        {
          "file": "/home/user/PRFactory/src/PRFactory.Domain/Entities/CodeReviewResult.cs",
          "line": 126,
          "pattern_type": "list-init-coalesce",
          "current": "criticalIssues ?? new List<string>()",
          "suggested": "criticalIssues ?? []",
          "tokens_saved": 8,
          "risk": "low"
        },
        {
          "file": "/home/user/PRFactory/src/PRFactory.Domain/Entities/CodeReviewResult.cs",
          "line": 127,
          "pattern_type": "list-init-coalesce",
          "current": "suggestions ?? new List<string>()",
          "suggested": "suggestions ?? []",
          "tokens_saved": 8,
          "risk": "low"
        },
        {
          "file": "/home/user/PRFactory/src/PRFactory.Domain/Entities/CodeReviewResult.cs",
          "line": 128,
          "pattern_type": "list-init-coalesce",
          "current": "praise ?? new List<string>()",
          "suggested": "praise ?? []",
          "tokens_saved": 8,
          "risk": "low"
        },
        {
          "file": "/home/user/PRFactory/src/PRFactory.Web/Services/AgentPromptService.cs",
          "line": 44,
          "pattern_type": "list-init-ternary",
          "current": "new List<AgentPromptTemplateDto> { MapToDto(template) } : new List<AgentPromptTemplateDto>()",
          "suggested": "[MapToDto(template)] : []",
          "tokens_saved": 16,
          "risk": "low"
        }
      ]
    },
    "array_initialization": {
      "count": 2,
      "description": "new T[] { ... } patterns (reflection/params)",
      "avg_tokens_per_item": 8,
      "findings": [
        {
          "file": "/home/user/PRFactory/src/PRFactory.Infrastructure/Git/GitServiceCollectionExtensions.cs",
          "line": 148,
          "pattern_type": "array-init",
          "current": "new object[] { id, ct }",
          "suggested": "[id, ct]",
          "tokens_saved": 8,
          "risk": "low",
          "note": "Used in reflection - object[] can be simplified"
        },
        {
          "file": "/home/user/PRFactory/src/PRFactory.Infrastructure/Git/GitPlatformService.cs",
          "line": 274,
          "pattern_type": "array-init",
          "current": "new object[] { _repositoryGetter }",
          "suggested": "[_repositoryGetter]",
          "tokens_saved": 8,
          "risk": "low",
          "note": "Used in reflection - object[] can be simplified"
        }
      ]
    },
    "dictionary_initialization": {
      "count": 3,
      "description": "new Dictionary<K,V> { ... } patterns",
      "avg_tokens_per_item": 12,
      "findings": [
        {
          "file": "/home/user/PRFactory/src/PRFactory.Infrastructure/Jira/Models/JiraContent.cs",
          "line": 128,
          "pattern_type": "dict-init-builder",
          "current": "Attrs = new Dictionary<string, object> { [\"level\"] = level }",
          "suggested": "Attrs = new Dictionary<string, object> { { \"level\", level } } or use object initializer",
          "tokens_saved": 8,
          "risk": "low",
          "note": "Indexer syntax already modern - collection expression would be: {new KeyValuePair<string, object>(\"level\", level)}"
        },
        {
          "file": "/home/user/PRFactory/src/PRFactory.Infrastructure/Jira/Models/JiraContent.cs",
          "line": 144,
          "pattern_type": "dict-init-ternary",
          "current": "new Dictionary<string, object> { [\"language\"] = language } : null",
          "suggested": "/* Note: Can't use collection expr in ternary easily without explicit type */",
          "tokens_saved": 0,
          "risk": "high",
          "note": "MANUAL REVIEW: Ternary operator with Dictionary - type inference challenge"
        },
        {
          "file": "/home/user/PRFactory/src/PRFactory.Infrastructure/Jira/Models/JiraContent.cs",
          "line": 216,
          "pattern_type": "dict-init-builder",
          "current": "Attrs = new Dictionary<string, object> { [\"href\"] = href }",
          "suggested": "Attrs = new Dictionary<string, object> { { \"href\", href } }",
          "tokens_saved": 8,
          "risk": "low"
        }
      ]
    },
    "concat_chains": {
      "count": 3,
      "description": ".Concat().ToList/ToArray patterns - most complex conversions",
      "avg_tokens_per_item": 16,
      "findings": [
        {
          "file": "/home/user/PRFactory/src/PRFactory.Infrastructure/Application/PlanReviewService.cs",
          "line": 46,
          "pattern_type": "concat-chain-complex",
          "current": "var allReviewerIds = requiredReviewerIds.Concat(optionalReviewerIds ?? new List<Guid>()).ToList();",
          "suggested": "var allReviewerIds = [..requiredReviewerIds, ..(optionalReviewerIds ?? [])];",
          "tokens_saved": 18,
          "risk": "medium",
          "note": "Nested null-coalesce with concat - needs careful refactoring. Can also simplify inner List() to []"
        },
        {
          "file": "/home/user/PRFactory/src/PRFactory.Infrastructure/Agents/Graphs/WorkflowOrchestrator.cs",
          "line": 491,
          "pattern_type": "concat-in-stringjoin",
          "current": "string.Join(\"\\n\", reviewComplete.CriticalIssues.Concat(reviewComplete.Suggestions))",
          "suggested": "string.Join(\"\\n\", [..reviewComplete.CriticalIssues, ..reviewComplete.Suggestions])",
          "tokens_saved": 14,
          "risk": "low",
          "note": "Simple concat pattern - straightforward conversion"
        },
        {
          "file": "/home/user/PRFactory/src/PRFactory.Infrastructure/Agents/Graphs/CodeReviewGraph.cs",
          "line": 191,
          "pattern_type": "concat-in-stringjoin",
          "current": "string.Join(\"\\n\", criticalIssues.Concat(suggestions))",
          "suggested": "string.Join(\"\\n\", [..criticalIssues, ..suggestions])",
          "tokens_saved": 12,
          "risk": "low"
        }
      ]
    },
    "tolist_operations": {
      "count": 24,
      "description": "LINQ .ToList() operations - already reasonably modern but could be optimized",
      "avg_tokens_per_item": 4,
      "note": "These are not 'collection expressions' but worth tracking. .ToList() is still idiomatic.",
      "notable_patterns": [
        {
          "file": "/home/user/PRFactory/src/PRFactory.Infrastructure/Agents/Graphs/GraphBuilder.cs",
          "line": 339,
          "pattern_type": "toarray-from-select",
          "current": "var tasks = Branches.Select(branch => branch.ExecuteAsync(...)).ToArray();",
          "note": "Already using ToArray() which is appropriate for Task.WhenAll()"
        }
      ]
    },
    "asreadonly_patterns": {
      "count": 3,
      "description": ".AsReadOnly() patterns - can use collection expressions for immutability",
      "avg_tokens_per_item": 10,
      "findings": [
        {
          "file": "/home/user/PRFactory/src/PRFactory.Infrastructure/Agents/AgentRegistry.cs",
          "line": 120,
          "pattern_type": "tolist-asreadonly",
          "current": "return _agents.Values.ToList().AsReadOnly();",
          "suggested": "return _agents.Values.ToList().AsReadOnly(); /* or */ return [.._agents.Values];",
          "tokens_saved": 10,
          "risk": "medium",
          "note": "MANUAL REVIEW: .ToList().AsReadOnly() vs [..collection] - type inference may differ (IList vs ICollection)"
        },
        {
          "file": "/home/user/PRFactory/src/PRFactory.Domain/ValueObjects/WorkflowStateTransitions.cs",
          "line": 137,
          "pattern_type": "list-init-asreadonly",
          "current": "new List<WorkflowState>().AsReadOnly()",
          "suggested": "[].AsReadOnly() or ImmutableList<WorkflowState>.Empty",
          "tokens_saved": 8,
          "risk": "medium",
          "note": "Empty list with AsReadOnly - could use ImmutableList for better semantics"
        }
      ]
    }
  },
  "complexity_analysis": {
    "simple_conversions": {
      "count": 35,
      "description": "Direct 1:1 mappings, no type inference issues",
      "examples": [
        "new List<string> { \"a\", \"b\" } → [\"a\", \"b\"]",
        "new object[] { id, ct } → [id, ct]",
        "mentionedUserIds ?? new List<Guid>() → mentionedUserIds ?? []"
      ],
      "estimated_automation": "100% - can be automated with roslyn analyzer"
    },
    "medium_complexity": {
      "count": 15,
      "description": "Type inference required but straightforward",
      "examples": [
        "Field initializers with empty lists",
        ".Concat() patterns in method calls",
        "AsReadOnly() with explicit type context"
      ],
      "estimated_automation": "85% - mostly automatable, test type compatibility"
    },
    "high_complexity": {
      "count": 6,
      "description": "Requires manual review and careful refactoring",
      "examples": [
        "Dictionary in ternary operator (line 144 JiraContent.cs)",
        "Complex null coalescing with Concat",
        "AsReadOnly() with IList vs ICollection type distinction"
      ],
      "estimated_automation": "0% - manual review required"
    }
  },
  "recommendations": {
    "priority_1_easy_wins": [
      {
        "pattern": "Empty list coalescing",
        "count": 6,
        "tokens_saved": 48,
        "description": "Replace `new List<T>()` with `[]` in null-coalesce patterns"
      },
      {
        "pattern": "Simple list literals",
        "count": 8,
        "tokens_saved": 72,
        "description": "Replace `new List<string> { ... }` with `[...]` in straightforward contexts"
      }
    ],
    "priority_2_medium_effort": [
      {
        "pattern": "Field initializers",
        "count": 2,
        "tokens_saved": 16,
        "description": "Replace field initialization lists with collection expressions - verify type inference"
      },
      {
        "pattern": "Concat chains",
        "count": 3,
        "tokens_saved": 44,
        "description": "Convert .Concat().ToList() to spread syntax [..a, ..b]"
      }
    ],
    "priority_3_manual_review": [
      {
        "pattern": "Dictionary ternaries",
        "count": 1,
        "tokens_saved": 0,
        "description": "Line 144 JiraContent.cs - requires careful type inference"
      },
      {
        "pattern": "AsReadOnly patterns",
        "count": 3,
        "tokens_saved": 28,
        "description": "Review IList vs ICollection semantics when converting to collection expressions"
      }
    ]
  },
  "implementation_strategy": {
    "phase_1": {
      "name": "Easy wins",
      "effort": "Low",
      "risk": "Minimal",
      "items": [
        "Empty list coalescing (6 items)",
        "Simple list literals with explicit types (8 items)"
      ],
      "files_affected": 8,
      "estimated_tokens_saved": 120
    },
    "phase_2": {
      "name": "Straightforward conversions",
      "effort": "Medium",
      "risk": "Low-Medium",
      "items": [
        "Field initializers (2 items)",
        "Concat chains (3 items)",
        "Simple array init (2 items)"
      ],
      "files_affected": 7,
      "estimated_tokens_saved": 132
    },
    "phase_3": {
      "name": "Manual review required",
      "effort": "High",
      "risk": "Medium-High",
      "items": [
        "Dictionary in ternary (1 item) - SKIP or handle specially",
        "AsReadOnly patterns (3 items) - verify immutability semantics"
      ],
      "files_affected": 4,
      "estimated_tokens_saved": 36,
      "note": "Consider if modernization is worth the review effort"
    }
  },
  "tools_and_automation": {
    "roslyn_analyzer": {
      "recommended": true,
      "can_automate": "~85% of findings",
      "note": "Microsoft.CodeAnalysis IDE0305 and related rules"
    },
    "manual_patterns": [
      "Dictionary in ternary operators",
      "AsReadOnly() type semantics verification",
      "Complex null-coalesce chains"
    ]
  },
  "estimated_impact": {
    "total_tokens_saved": 642,
    "lines_of_code_saved": 28,
    "modernization_score": "8/10",
    "readability_improvement": "Moderate",
    "maintenance_improvement": "Low-Moderate",
    "performance_impact": "None (compile-time feature)"
  }
}
