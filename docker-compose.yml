version: '3.8'

services:
  prfactory:
    image: prfactory:latest
    build:
      context: .
      dockerfile: src/PRFactory.Web/Dockerfile
    container_name: prfactory
    ports:
      - "5000:8080"   # API endpoint
      - "5003:8080"   # Blazor UI (same port, different external mapping)
    environment:
      - ASPNETCORE_ENVIRONMENT=Development
      - ASPNETCORE_URLS=http://+:8080
      - ConnectionStrings__Database=Data Source=/data/prfactory.db
      - Logging__LogLevel__Default=Information
      - Logging__LogLevel__Microsoft__AspNetCore=Warning
    volumes:
      - ./data:/var/prfactory/data
      - ./logs:/var/prfactory/logs
      - ./workspace:/var/prfactory/workspace
    networks:
      - prfactory-network
    restart: unless-stopped
    healthcheck:
      test: ["CMD", "curl", "-f", "http://localhost:8080/health"]
      interval: 30s
      timeout: 3s
      retries: 3
      start_period: 10s

networks:
  prfactory-network:
    driver: bridge

volumes:
  data:
    driver: local
  logs:
    driver: local
  workspace:
    driver: local
