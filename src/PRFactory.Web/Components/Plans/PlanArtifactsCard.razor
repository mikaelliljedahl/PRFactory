@using PRFactory.Core.Application.DTOs
@using PRFactory.Web.UI.Cards
@using PRFactory.Web.UI.Display
@using Radzen.Blazor

@if (Plan != null && Plan.HasMultipleArtifacts)
{
    <Card Title="Implementation Plan Artifacts" Icon="folder" AdditionalClass="@AdditionalClass">
        <RadzenTabs>
            <Tabs>
                @* User Stories Tab *@
                <RadzenTabsItem Text="User Stories">
                    <div class="p-3">
                        @if (!string.IsNullOrEmpty(Plan.UserStories))
                        {
                            <MarkdownViewer Content="@Plan.UserStories" />
                        }
                        else
                        {
                            <EmptyState Message="User stories not yet generated" Icon="file-earmark-text" />
                        }
                    </div>
                </RadzenTabsItem>

                @* API Design Tab *@
                <RadzenTabsItem Text="API Design">
                    <div class="p-3">
                        @if (!string.IsNullOrEmpty(Plan.ApiDesign))
                        {
                            <CodeBlock Content="@Plan.ApiDesign" Language="yaml" />
                        }
                        else
                        {
                            <EmptyState Message="API design not yet generated" Icon="code-slash" />
                        }
                    </div>
                </RadzenTabsItem>

                @* Database Schema Tab *@
                <RadzenTabsItem Text="Database Schema">
                    <div class="p-3">
                        @if (!string.IsNullOrEmpty(Plan.DatabaseSchema))
                        {
                            <CodeBlock Content="@Plan.DatabaseSchema" Language="sql" />
                        }
                        else
                        {
                            <EmptyState Message="Database schema not yet generated" Icon="database" />
                        }
                    </div>
                </RadzenTabsItem>

                @* Test Cases Tab *@
                <RadzenTabsItem Text="Test Cases">
                    <div class="p-3">
                        @if (!string.IsNullOrEmpty(Plan.TestCases))
                        {
                            <MarkdownViewer Content="@Plan.TestCases" />
                        }
                        else
                        {
                            <EmptyState Message="Test cases not yet generated" Icon="check2-square" />
                        }
                    </div>
                </RadzenTabsItem>

                @* Implementation Steps Tab *@
                <RadzenTabsItem Text="Implementation Steps">
                    <div class="p-3">
                        @if (!string.IsNullOrEmpty(Plan.ImplementationSteps))
                        {
                            <MarkdownViewer Content="@Plan.ImplementationSteps" />
                        }
                        else
                        {
                            <EmptyState Message="Implementation steps not yet generated" Icon="list-ol" />
                        }
                    </div>
                </RadzenTabsItem>

                @* Version History Tab (optional) *@
                @if (Plan.Versions?.Any() == true)
                {
                    <RadzenTabsItem Text="Version History">
                        <div class="p-3">
                            <PlanVersionHistory Versions="@Plan.Versions"
                                                OnVersionSelected="HandleVersionSelected" />
                        </div>
                    </RadzenTabsItem>
                }
            </Tabs>
        </RadzenTabs>
    </Card>
}
else if (Plan != null)
{
    @* Fallback for old single-file plans *@
    <Card Title="Implementation Plan" Icon="file-earmark-text" AdditionalClass="@AdditionalClass">
        <MarkdownViewer Content="@(Plan.Content ?? string.Empty)" />
    </Card>
}
