@using PRFactory.Web.UI.Forms
@using PRFactory.Web.UI.Buttons
@using PRFactory.Web.Models

<EditForm Model="@Model" OnValidSubmit="@HandleValidSubmit">
    <DataAnnotationsValidator />

    <div class="row">
        <div class="col-md-6">
            <FormTextField @bind-Value="Model.Name"
                          Label="Repository Name"
                          Placeholder="my-awesome-project"
                          Required="true"
                          HelpText="A friendly name for this repository"
                          HelpTooltipText="A friendly name to identify this repository in PRFactory (doesn't need to match Git repo name)."
                          For="@(() => Model.Name)" />
        </div>

        <div class="col-md-6">
            <FormSelectField @bind-Value="Model.GitPlatform"
                            Label="Git Platform"
                            Required="true"
                            HelpText="Select your Git hosting platform"
                            HelpTooltipText="Select your Git hosting provider. This determines how PRFactory creates branches and pull requests."
                            For="@(() => Model.GitPlatform)">
                <option value="">-- Select Platform --</option>
                <option value="GitHub">GitHub</option>
                <option value="Bitbucket">Bitbucket</option>
                <option value="AzureDevOps">Azure DevOps</option>
                <option value="GitLab">GitLab</option>
            </FormSelectField>
        </div>
    </div>

    <div class="row">
        <div class="col-12">
            <FormTextField @bind-Value="Model.CloneUrl"
                          Label="Clone URL"
                          Placeholder="https://github.com/username/repository.git"
                          Required="true"
                          HelpText="The HTTPS clone URL of your repository"
                          HelpTooltipText="The full HTTPS URL for cloning your repository. Find this in your Git platform's clone/download section."
                          For="@(() => Model.CloneUrl)" />
        </div>
    </div>

    @if (ShowTenantSelection && Tenants != null && Tenants.Any())
    {
        <div class="row">
            <div class="col-12">
                <FormSelectField @bind-Value="Model.TenantId"
                                Label="Tenant"
                                Required="true"
                                HelpText="Select the tenant that owns this repository"
                                For="@(() => Model.TenantId)">
                    <option value="@Guid.Empty">-- Select Tenant --</option>
                    @foreach (var tenant in Tenants)
                    {
                        <option value="@tenant.Id">@tenant.Name</option>
                    }
                </FormSelectField>
            </div>
        </div>
    }

    <div class="row">
        <div class="col-md-6">
            <FormTextField @bind-Value="Model.DefaultBranch"
                          Label="Default Branch"
                          Placeholder="main"
                          Required="true"
                          HelpText="The default branch to use (usually 'main' or 'master')"
                          HelpTooltipText="The main branch that PRFactory will create feature branches from. Typically 'main' or 'master'."
                          For="@(() => Model.DefaultBranch)" />
        </div>

        <div class="col-md-6">
            <FormTextField @bind-Value="Model.AccessToken"
                          Label="Access Token"
                          InputType="password"
                          Placeholder="Enter access token"
                          Required="@(!IsEditMode)"
                          HelpText="@(IsEditMode ? "Leave blank to keep existing token" : "Personal access token for Git operations")"
                          HelpTooltipText="GitHub: Settings → Developer Settings → Personal Access Tokens. Bitbucket: Account Settings → App Passwords. Azure DevOps: User Settings → Personal Access Tokens. Token needs repo read/write permissions."
                          HelpTooltipLearnMoreUrl="https://docs.github.com/en/authentication/keeping-your-account-and-data-secure/creating-a-personal-access-token"
                          For="@(() => Model.AccessToken)" />
        </div>
    </div>

    @if (IsEditMode && Model is UpdateRepositoryRequest updateModel)
    {
        <div class="row">
            <div class="col-12">
                <div class="form-check mb-3">
                    <input class="form-check-input" type="checkbox" id="isActive" @bind="updateModel.IsActive" />
                    <label class="form-check-label" for="isActive">
                        Repository is active
                    </label>
                </div>
            </div>
        </div>
    }

    <div class="d-flex gap-2 justify-content-end">
        @if (OnCancel.HasDelegate)
        {
            <button type="button" class="btn btn-secondary" @onclick="HandleCancel">
                <i class="bi bi-x-circle me-2"></i>Cancel
            </button>
        }

        <LoadingButton IsLoading="@IsSubmitting"
                      Icon="check-circle"
                      ButtonType="submit">
            @SubmitButtonText
        </LoadingButton>
    </div>
</EditForm>
