@using PRFactory.Web.UI.Forms
@using PRFactory.Web.UI.Help
@using PRFactory.Core.Application.DTOs

<div class="row">
    <div class="col-md-6">
        @* Enable Auto Code Review *@
        <div class="form-check mb-3">
            <input class="form-check-input" type="checkbox" id="enableCodeReview"
                   @bind="Configuration.EnableAutoCodeReview"
                   disabled="@(!CanEdit)" />
            <label class="form-check-label" for="enableCodeReview">
                Enable Auto Code Review
            </label>
            <ContextualHelp HelpText="Automatically trigger code review after PR creation (requires Code Review LLM provider)" />
        </div>

        @if (Configuration.EnableAutoCodeReview)
        {
            @* Max Iterations *@
            <div class="mb-3">
                <label for="maxIterations" class="form-label">
                    Max Code Review Iterations
                </label>
                <input type="number"
                       id="maxIterations"
                       class="form-control"
                       @bind="Configuration.MaxCodeReviewIterations"
                       min="1"
                       max="10"
                       disabled="@(!CanEdit)" />
                <small class="form-text text-muted">Maximum number of review/fix iterations (1-10)</small>
            </div>

            @* Auto-Approve *@
            <div class="form-check mb-3">
                <input class="form-check-input" type="checkbox" id="autoApprove"
                       @bind="Configuration.AutoApproveIfNoIssues"
                       disabled="@(!CanEdit)" />
                <label class="form-check-label" for="autoApprove">
                    Auto-Approve If No Issues
                </label>
                <ContextualHelp HelpText="Automatically approve PR if no issues found (still requires human merge)" />
            </div>
        }
        else
        {
            <div class="alert alert-info">
                <i class="bi bi-info-circle me-2"></i>
                Enable auto code review to configure additional settings.
            </div>
        }
    </div>

    <div class="col-md-6">
        @* Warning if no Code Review provider assigned *@
        @if (Configuration.EnableAutoCodeReview && !Configuration.CodeReviewLlmProviderId.HasValue)
        {
            <div class="alert alert-warning">
                <i class="bi bi-exclamation-triangle me-2"></i>
                <strong>Warning:</strong> No Code Review LLM provider assigned. Go to the "LLM Providers" tab to assign one.
            </div>
        }

        @* Future: Require Human Approval (read-only for now) *@
        <div class="form-check mb-3">
            <input class="form-check-input" type="checkbox" id="requireHumanApproval"
                   checked="@true"
                   disabled />
            <label class="form-check-label text-muted" for="requireHumanApproval">
                Require Human Approval After Review (always enabled)
            </label>
            <ContextualHelp HelpText="Human approval is always required before merging, even if code passes review" />
        </div>
    </div>
</div>
