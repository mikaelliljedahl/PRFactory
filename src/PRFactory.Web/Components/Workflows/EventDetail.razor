@using PRFactory.Web.Models
@using PRFactory.Web.UI.Cards
@using PRFactory.Web.UI.Display
@using Radzen.Blazor

@if (Event != null)
{
    <Card Title="Event Details" Icon="info-circle">
        <div class="mb-3">
            <strong>Event Type:</strong>
            <span class="badge bg-primary ms-2">@Event.EventType</span>
        </div>

        <div class="mb-3">
            <strong>Occurred At:</strong>
            <div class="mt-1">
                <i class="bi bi-clock me-1"></i>@Event.OccurredAt.ToString("MMMM dd, yyyy HH:mm:ss UTC")
                <div class="text-muted small">
                    <RelativeTime Timestamp="@Event.OccurredAt" />
                </div>
            </div>
        </div>

        @if (!string.IsNullOrEmpty(Event.TicketKey))
        {
            <div class="mb-3">
                <strong>Ticket:</strong>
                <a href="/tickets/@Event.TicketId" class="ms-2">
                    <i class="bi bi-ticket-perforated me-1"></i>@Event.TicketKey
                </a>
            </div>
        }

        <div class="mb-3">
            <strong>Severity:</strong>
            <span class="badge @GetSeverityBadgeClass() ms-2">
                <i class="bi bi-@Event.Icon me-1"></i>@Event.Severity
            </span>
        </div>

        <div class="mb-3">
            <strong>Description:</strong>
            <div class="mt-1 p-2 bg-light rounded">
                @Event.Description
            </div>
        </div>

        @if (Event.FromState.HasValue || Event.ToState.HasValue)
        {
            <div class="mb-3">
                <strong>State Transition:</strong>
                <div class="mt-2">
                    @if (Event.FromState.HasValue)
                    {
                        <StatusBadge State="@Event.FromState.Value" />
                        <i class="bi bi-arrow-right mx-2"></i>
                    }
                    @if (Event.ToState.HasValue)
                    {
                        <StatusBadge State="@Event.ToState.Value" />
                    }
                </div>
            </div>
        }

        @if (!string.IsNullOrEmpty(Event.Reason))
        {
            <div class="mb-3">
                <strong>Reason:</strong>
                <div class="mt-1 p-2 bg-light rounded">
                    @Event.Reason
                </div>
            </div>
        }

        @if (Event.Metadata.Any())
        {
            <div class="mb-3">
                <strong>Additional Information:</strong>
                <div class="mt-2">
                    @foreach (var (key, value) in Event.Metadata)
                    {
                        <div class="mb-2">
                            <span class="text-muted">@FormatMetadataKey(key):</span>
                            <span class="ms-2">@value</span>
                        </div>
                    }
                </div>
            </div>
        }

        @if (!string.IsNullOrEmpty(Event.MetadataJson))
        {
            <div class="mb-3">
                <strong>Raw Metadata (JSON):</strong>
                <RadzenTextArea @bind-Value="@Event.MetadataJson"
                                ReadOnly="true"
                                Rows="10"
                                Style="width: 100%; font-family: monospace; font-size: 0.85rem;"
                                class="mt-2" />
            </div>
        }

        <div class="mt-3">
            <small class="text-muted">
                <i class="bi bi-key me-1"></i>Event ID: @Event.Id
            </small>
        </div>
    </Card>
}
else
{
    <Card>
        <div class="text-center text-muted py-4">
            <i class="bi bi-info-circle fs-1"></i>
            <p class="mt-2">Select an event to view details</p>
        </div>
    </Card>
}
