@page "/settings/llm-providers/{id:guid}"
@attribute [Authorize(Roles = "Owner,Admin,Member")]

<PageTitle>LLM Provider Details - PRFactory</PageTitle>

<div class="container-fluid">
    <div class="row mb-4">
        <div class="col">
            <nav aria-label="breadcrumb">
                <ol class="breadcrumb">
                    <li class="breadcrumb-item"><a href="/settings/llm-providers">LLM Providers</a></li>
                    <li class="breadcrumb-item active" aria-current="page">Details</li>
                </ol>
            </nav>
            <h1 class="display-6">
                <i class="bi bi-robot"></i> LLM Provider Details
            </h1>
        </div>
    </div>

    @if (isLoading)
    {
        <LoadingSpinner Message="Loading provider..." />
    }
    else if (provider == null)
    {
        <AlertMessage Type="AlertType.Danger"
                     Message="Provider not found or you don't have permission to view it." />
    }
    else
    {
        <div class="row g-3">
            <div class="col-md-8">
                <Card Title="@provider.Name" Icon="bi-gear">
                    <div class="row mb-3">
                        <div class="col-md-6">
                            <strong>Provider Type:</strong>
                            <span class="badge bg-info ms-2">@provider.ProviderType</span>
                        </div>
                        <div class="col-md-6">
                            <strong>Authentication:</strong>
                            @if (provider.UsesOAuth)
                            {
                                <span class="badge bg-primary ms-2">
                                    <i class="bi bi-lock-fill"></i> OAuth
                                </span>
                            }
                            else
                            {
                                <span class="badge bg-secondary ms-2">
                                    <i class="bi bi-key-fill"></i> API Key
                                </span>
                            }
                        </div>
                    </div>

                    <div class="row mb-3">
                        <div class="col-md-6">
                            <strong>Default Model:</strong>
                            <code class="ms-2">@provider.DefaultModel</code>
                        </div>
                        <div class="col-md-6">
                            <strong>Timeout:</strong>
                            <span class="ms-2">@provider.TimeoutMs ms</span>
                        </div>
                    </div>

                    @if (!string.IsNullOrEmpty(provider.ApiBaseUrl))
                    {
                        <div class="row mb-3">
                            <div class="col-md-12">
                                <strong>API Base URL:</strong>
                                <code class="ms-2">@provider.ApiBaseUrl</code>
                            </div>
                        </div>
                    }

                    <div class="row mb-3">
                        <div class="col-md-6">
                            <strong>Status:</strong>
                            @if (provider.IsActive)
                            {
                                <span class="badge bg-success ms-2">Active</span>
                            }
                            else
                            {
                                <span class="badge bg-secondary ms-2">Inactive</span>
                            }
                        </div>
                        <div class="col-md-6">
                            <strong>Default Provider:</strong>
                            @if (provider.IsDefault)
                            {
                                <span class="badge bg-warning ms-2">
                                    <i class="bi bi-star-fill"></i> Default
                                </span>
                            }
                            else
                            {
                                <span class="text-muted ms-2">No</span>
                            }
                        </div>
                    </div>

                    <div class="row mb-3">
                        <div class="col-md-12">
                            <strong>Created:</strong>
                            <span class="ms-2">@provider.CreatedAt.ToString("yyyy-MM-dd HH:mm:ss")</span>
                        </div>
                    </div>

                    <div class="mt-4 d-flex gap-2">
                        @if (canEdit)
                        {
                            <button class="btn btn-primary" @onclick="NavigateToEdit">
                                <i class="bi bi-pencil me-2"></i>Edit
                            </button>

                            @if (!provider.IsDefault)
                            {
                                <button class="btn btn-warning" @onclick="HandleSetDefaultAsync">
                                    <i class="bi bi-star me-2"></i>Set as Default
                                </button>
                            }

                            <button class="btn btn-info" @onclick="HandleTestConnectionAsync" disabled="@isTesting">
                                @if (isTesting)
                                {
                                    <span class="spinner-border spinner-border-sm me-2" role="status"></span>
                                    <span>Testing...</span>
                                }
                                else
                                {
                                    <i class="bi bi-plug me-2"></i>
                                    <span>Test Connection</span>
                                }
                            </button>
                        }

                        <button class="btn btn-secondary" @onclick="NavigateToList">
                            <i class="bi bi-arrow-left me-2"></i>Back to List
                        </button>
                    </div>
                </Card>
            </div>

            <div class="col-md-4">
                <Card Title="Usage Statistics" Icon="bi-graph-up">
                    <LlmProviderStatistics TotalRequests="0"
                                          SuccessfulRequests="0"
                                          FailedRequests="0"
                                          AverageResponseTimeMs="0" />

                    <div class="mt-3 alert alert-info">
                        <small>
                            <i class="bi bi-info-circle me-2"></i>
                            Usage statistics will be available in a future update.
                        </small>
                    </div>
                </Card>
            </div>
        </div>
    }
</div>
