@page "/tenants/{TenantId:guid}"
@using PRFactory.Web.Components.Tenants
@using PRFactory.Web.UI.Alerts
@using PRFactory.Web.UI.Display
@using PRFactory.Web.UI.Buttons
@using Radzen.Blazor

<PageTitle>@(tenant?.Name ?? "Tenant") - PRFactory</PageTitle>

<div class="container-fluid">
    <div class="row mb-4">
        <div class="col">
            <nav aria-label="breadcrumb">
                <ol class="breadcrumb">
                    <li class="breadcrumb-item"><a href="/tenants">Tenants</a></li>
                    <li class="breadcrumb-item active" aria-current="page">@(tenant?.Name ?? "Loading...")</li>
                </ol>
            </nav>
            <div class="d-flex justify-content-between align-items-start">
                <div>
                    <h1 class="display-6">
                        <i class="bi bi-building"></i> @(tenant?.Name ?? "Loading...")
                        @if (tenant != null)
                        {
                            @if (tenant.IsActive)
                            {
                                <span class="badge bg-success ms-2">Active</span>
                            }
                            else
                            {
                                <span class="badge bg-secondary ms-2">Inactive</span>
                            }
                        }
                    </h1>
                    @if (tenant != null)
                    {
                        <p class="text-muted">
                            <i class="bi bi-link-45deg"></i>
                            <a href="@tenant.JiraUrl" target="_blank" rel="noopener noreferrer">@tenant.JiraUrl</a>
                        </p>
                    }
                </div>
                <div class="btn-group" role="group">
                    <a href="/tenants/@TenantId/edit" class="btn btn-outline-primary">
                        <i class="bi bi-pencil"></i> Edit
                    </a>
                    <a href="/tenants" class="btn btn-outline-secondary">
                        <i class="bi bi-arrow-left"></i> Back to List
                    </a>
                </div>
            </div>
        </div>
    </div>

    @if (isLoading)
    {
        <LoadingSpinner IsLoading="true" Message="Loading tenant details..." />
    }
    else if (errorMessage != null)
    {
        <AlertMessage Type="AlertType.Danger" Title="Error" Message="@errorMessage" Icon="exclamation-triangle-fill" />
    }
    else if (tenant != null)
    {
        <RadzenTabs>
            <Tabs>
                <!-- Overview Tab -->
                <RadzenTabsItem Text="Overview">
                    <div class="row mt-3">
                        <div class="col-lg-6">
                            <div class="card mb-3">
                                <div class="card-header bg-primary text-white">
                                    <i class="bi bi-info-circle"></i> Basic Information
                                </div>
                                <div class="card-body">
                                    <table class="table table-borderless mb-0">
                                        <tbody>
                                            <tr>
                                                <th style="width: 40%">Tenant ID:</th>
                                                <td><code>@tenant.Id</code></td>
                                            </tr>
                                            <tr>
                                                <th>Name:</th>
                                                <td>@tenant.Name</td>
                                            </tr>
                                            <tr>
                                                <th>Jira URL:</th>
                                                <td><a href="@tenant.JiraUrl" target="_blank">@tenant.JiraUrl</a></td>
                                            </tr>
                                            <tr>
                                                <th>Status:</th>
                                                <td>
                                                    @if (tenant.IsActive)
                                                    {
                                                        <span class="badge bg-success">Active</span>
                                                    }
                                                    else
                                                    {
                                                        <span class="badge bg-secondary">Inactive</span>
                                                    }
                                                </td>
                                            </tr>
                                            <tr>
                                                <th>Created:</th>
                                                <td><RelativeTime Timestamp="@tenant.CreatedAt" /></td>
                                            </tr>
                                            @if (tenant.UpdatedAt.HasValue)
                                            {
                                                <tr>
                                                    <th>Last Updated:</th>
                                                    <td><RelativeTime Timestamp="@tenant.UpdatedAt.Value" /></td>
                                                </tr>
                                            }
                                        </tbody>
                                    </table>
                                </div>
                            </div>

                            <div class="card mb-3">
                                <div class="card-header bg-success text-white">
                                    <i class="bi bi-shield-check"></i> Credentials Status
                                </div>
                                <div class="card-body">
                                    <div class="d-flex justify-content-between align-items-center mb-2">
                                        <span>Jira API Token:</span>
                                        @if (tenant.HasJiraApiToken)
                                        {
                                            <span class="badge bg-success"><i class="bi bi-check-circle"></i> Configured</span>
                                        }
                                        else
                                        {
                                            <span class="badge bg-danger"><i class="bi bi-x-circle"></i> Missing</span>
                                        }
                                    </div>
                                    <div class="d-flex justify-content-between align-items-center">
                                        <span>Claude API Key:</span>
                                        @if (tenant.HasClaudeApiKey)
                                        {
                                            <span class="badge bg-success"><i class="bi bi-check-circle"></i> Configured</span>
                                        }
                                        else
                                        {
                                            <span class="badge bg-danger"><i class="bi bi-x-circle"></i> Missing</span>
                                        }
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div class="col-lg-6">
                            <div class="card mb-3">
                                <div class="card-header bg-info text-white">
                                    <i class="bi bi-gear"></i> Configuration
                                </div>
                                <div class="card-body">
                                    <table class="table table-borderless mb-0">
                                        <tbody>
                                            <tr>
                                                <th style="width: 60%">Auto-implement after plan approval:</th>
                                                <td>
                                                    @if (tenant.AutoImplementAfterPlanApproval)
                                                    {
                                                        <span class="badge bg-success">Enabled</span>
                                                    }
                                                    else
                                                    {
                                                        <span class="badge bg-secondary">Disabled</span>
                                                    }
                                                </td>
                                            </tr>
                                            <tr>
                                                <th>Code review workflow:</th>
                                                <td>
                                                    @if (tenant.EnableCodeReview)
                                                    {
                                                        <span class="badge bg-success">Enabled</span>
                                                    }
                                                    else
                                                    {
                                                        <span class="badge bg-secondary">Disabled</span>
                                                    }
                                                </td>
                                            </tr>
                                            <tr>
                                                <th>Claude Model:</th>
                                                <td><code>@tenant.ClaudeModel</code></td>
                                            </tr>
                                            <tr>
                                                <th>Max Tokens per Request:</th>
                                                <td>@tenant.MaxTokensPerRequest.ToString("N0")</td>
                                            </tr>
                                            <tr>
                                                <th>Max Retries:</th>
                                                <td>@tenant.MaxRetries</td>
                                            </tr>
                                        </tbody>
                                    </table>
                                </div>
                            </div>

                            <div class="card mb-3">
                                <div class="card-header bg-secondary text-white">
                                    <i class="bi bi-bar-chart"></i> Statistics
                                </div>
                                <div class="card-body">
                                    <div class="row text-center">
                                        <div class="col-6">
                                            <h3 class="mb-0">@tenant.RepositoryCount</h3>
                                            <small class="text-muted">Repositories</small>
                                        </div>
                                        <div class="col-6">
                                            <h3 class="mb-0">@tenant.TicketCount</h3>
                                            <small class="text-muted">Tickets</small>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </RadzenTabsItem>

                <!-- Configuration Tab -->
                <RadzenTabsItem Text="Configuration">
                    <div class="mt-3">
                        <TenantConfigEditor TenantId="@TenantId" OnConfigurationSaved="@HandleConfigSavedAsync" />
                    </div>
                </RadzenTabsItem>

                <!-- Repositories Tab -->
                <RadzenTabsItem Text="Repositories">
                    <div class="mt-3">
                        <EmptyState
                            Icon="folder"
                            Title="Repository management coming soon"
                            Message="View and manage repositories associated with this tenant" />
                    </div>
                </RadzenTabsItem>

                <!-- Tickets Tab -->
                <RadzenTabsItem Text="Tickets">
                    <div class="mt-3">
                        <EmptyState
                            Icon="ticket-detailed"
                            Title="Ticket list coming soon"
                            Message="View all tickets processed for this tenant" />
                    </div>
                </RadzenTabsItem>
            </Tabs>
        </RadzenTabs>
    }
</div>
