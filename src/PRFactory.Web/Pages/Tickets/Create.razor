@page "/tickets/create"
@using PRFactory.Web.Models

<h1>Create New Ticket</h1>

<EditForm Model="@model" OnValidSubmit="@HandleSubmit">
    <DataAnnotationsValidator />
    <ValidationSummary />

    <div class="mb-3">
        <label for="title" class="form-label">Title</label>
        <InputText id="title" class="form-control" @bind-Value="model.Title" />
        <ValidationMessage For="@(() => model.Title)" />
    </div>

    <div class="mb-3">
        <label for="description" class="form-label">Description</label>
        <InputTextArea id="description" class="form-control" rows="5" @bind-Value="model.Description" />
        <ValidationMessage For="@(() => model.Description)" />
    </div>

    <div class="mb-3">
        <label for="repository" class="form-label">Repository</label>
        <InputSelect id="repository" class="form-select" @bind-Value="model.RepositoryId">
            <option value="">Select a repository...</option>
            @foreach (var repo in repositories)
            {
                <option value="@repo.Id">@repo.Name</option>
            }
        </InputSelect>
        <ValidationMessage For="@(() => model.RepositoryId)" />
    </div>

    <div class="mb-3 form-check">
        <InputCheckbox id="enableSync" class="form-check-input" @bind-Value="model.EnableExternalSync" />
        <label for="enableSync" class="form-check-label">
            Enable external system sync (Jira, Azure DevOps)
        </label>
    </div>

    @if (model.EnableExternalSync)
    {
        <div class="mb-3">
            <label for="externalSystem" class="form-label">External System</label>
            <InputSelect id="externalSystem" class="form-select" @bind-Value="model.ExternalSystem">
                <option value="">Select system...</option>
                <option value="Jira">Jira</option>
                <option value="AzureDevOps">Azure DevOps</option>
                <option value="GitHubIssues">GitHub Issues</option>
            </InputSelect>
        </div>
    }

    <div class="mt-3">
        <button type="submit" class="btn btn-primary" disabled="@isSubmitting">
            @if (isSubmitting)
            {
                <span class="spinner-border spinner-border-sm me-2"></span>
            }
            Create Ticket
        </button>
        <a href="/tickets" class="btn btn-secondary ms-2">Cancel</a>
    </div>
</EditForm>
