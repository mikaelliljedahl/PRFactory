@page "/tickets/create"
@using PRFactory.Web.Models
@using PRFactory.Web.UI.Forms
@using PRFactory.Web.UI.Alerts

<h1>Create New Ticket</h1>

@if (!string.IsNullOrEmpty(errorMessage))
{
    <div class="alert alert-danger alert-dismissible fade show" role="alert">
        <i class="bi bi-exclamation-triangle-fill me-2"></i>@errorMessage
        <button type="button" class="btn-close" @onclick="@(() => errorMessage = null)"></button>
    </div>
}

<EditForm Model="@model" OnValidSubmit="@HandleSubmit">
    <DataAnnotationsValidator />
    <ValidationSummary />

    <FormTextField
        Label="Title"
        Id="title"
        @bind-Value="model.Title"
        Required="true"
        For="@(() => model.Title)" />

    <FormTextAreaField
        Label="Description"
        Id="description"
        @bind-Value="model.Description"
        Rows="5"
        For="@(() => model.Description)" />

    <FormSelectField TValue="Guid"
                     Label="Repository"
                     Id="repository"
                     @bind-Value="model.RepositoryId"
                     DefaultOptionText="Select a repository..."
                     Required="true"
                     For="@(() => model.RepositoryId)">
        @foreach (var repo in repositories)
        {
            <option value="@repo.Id">@repo.Name</option>
        }
    </FormSelectField>

    <FormCheckboxField
        Label="Enable external system sync (Jira, Azure DevOps)"
        Id="enableSync"
        @bind-Value="model.EnableExternalSync" />

    @if (model.EnableExternalSync)
    {
        <FormSelectField TValue="string"
                         Label="External System"
                         Id="externalSystem"
                         @bind-Value="model.ExternalSystem"
                         DefaultOptionText="Select system...">
            <option value="Jira">Jira</option>
            <option value="AzureDevOps">Azure DevOps</option>
            <option value="GitHubIssues">GitHub Issues</option>
        </FormSelectField>
    }

    <div class="mt-3">
        <button type="submit" class="btn btn-primary" disabled="@isSubmitting">
            @if (isSubmitting)
            {
                <span class="spinner-border spinner-border-sm me-2"></span>
            }
            Create Ticket
        </button>
        <a href="/tickets" class="btn btn-secondary ms-2">Cancel</a>
    </div>
</EditForm>
