@namespace PRFactory.Web.UI.Display

@*
Pure UI component for displaying a user avatar with optional status badge.
Used in team review interfaces to show reviewer avatars.
*@

@if (!string.IsNullOrEmpty(AvatarUrl))
{
    <div class="reviewer-avatar @SizeClass" style="position: relative;">
        <img src="@AvatarUrl"
             alt="@DisplayName"
             class="rounded-circle"
             style="width: 100%; height: 100%; object-fit: cover;" />
        @if (!string.IsNullOrEmpty(StatusBadgeColor))
        {
            <span class="position-absolute bottom-0 end-0 badge rounded-pill bg-@StatusBadgeColor"
                  style="border: 2px solid white;">
                @StatusBadgeText
            </span>
        }
    </div>
}
else
{
    <div class="reviewer-avatar @SizeClass bg-@BackgroundColor d-flex align-items-center justify-content-center rounded-circle text-white fw-bold"
         style="position: relative;">
        @GetInitials()
        @if (!string.IsNullOrEmpty(StatusBadgeColor))
        {
            <span class="position-absolute bottom-0 end-0 badge rounded-pill bg-@StatusBadgeColor"
                  style="border: 2px solid white;">
                @StatusBadgeText
            </span>
        }
    </div>
}

@code {
    [Parameter] public string DisplayName { get; set; } = string.Empty;
    [Parameter] public string? AvatarUrl { get; set; }
    [Parameter] public AvatarSize Size { get; set; } = AvatarSize.Medium;
    [Parameter] public string? StatusBadgeText { get; set; }
    [Parameter] public string? StatusBadgeColor { get; set; }
    [Parameter] public string BackgroundColor { get; set; } = "primary";

    private string SizeClass => Size switch
    {
        AvatarSize.Small => "avatar-sm",
        AvatarSize.Medium => "avatar-md",
        AvatarSize.Large => "avatar-lg",
        _ => "avatar-md"
    };

    private string GetInitials()
    {
        if (string.IsNullOrWhiteSpace(DisplayName))
            return "?";

        var parts = DisplayName.Trim().Split(' ', StringSplitOptions.RemoveEmptyEntries);
        if (parts.Length >= 2)
        {
            return $"{parts[0][0]}{parts[1][0]}".ToUpper();
        }
        else if (parts.Length == 1 && parts[0].Length >= 2)
        {
            return parts[0].Substring(0, 2).ToUpper();
        }
        else if (parts.Length == 1 && parts[0].Length == 1)
        {
            return parts[0].ToUpper();
        }

        return "?";
    }

    public enum AvatarSize
    {
        Small,
        Medium,
        Large
    }
}
