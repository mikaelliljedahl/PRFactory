@using PRFactory.Domain.ValueObjects

<span class="@BadgeClass">
    @if (!string.IsNullOrEmpty(Icon))
    {
        <i class="bi bi-@Icon me-1"></i>
    }
    @DisplayText
</span>

@code {
    [Parameter] public WorkflowState State { get; set; }
    [Parameter] public string? CustomText { get; set; }
    [Parameter] public string? Icon { get; set; }
    [Parameter] public bool UseFriendlyNames { get; set; } = true;

    private string DisplayText => CustomText ?? (UseFriendlyNames ? GetFriendlyStateName(State) : GetTechnicalStateName(State));

    private static string GetFriendlyStateName(WorkflowState state) => state switch
    {
        WorkflowState.Triggered => "Getting Started",
        WorkflowState.Analyzing => "Analyzing Code",
        WorkflowState.TicketUpdateGenerated => "Update Ready",
        WorkflowState.TicketUpdateUnderReview => "Reviewing AI Update",
        WorkflowState.TicketUpdateRejected => "Update Rejected",
        WorkflowState.TicketUpdateApproved => "Update Approved",
        WorkflowState.TicketUpdatePosted => "Update Posted",
        WorkflowState.QuestionsPosted => "Questions Asked",
        WorkflowState.AwaitingAnswers => "Awaiting Your Answers",
        WorkflowState.AnswersReceived => "Answers Received",
        WorkflowState.Planning => "Creating Plan",
        WorkflowState.PlanPosted => "Plan Ready",
        WorkflowState.PlanUnderReview => "Reviewing Plan",
        WorkflowState.PlanApproved => "Plan Approved",
        WorkflowState.PlanRejected => "Plan Rejected",
        WorkflowState.Implementing => "Building Code",
        WorkflowState.ImplementationFailed => "Build Failed",
        WorkflowState.PRCreated => "PR Created",
        WorkflowState.InReview => "In Code Review",
        WorkflowState.Completed => "Completed",
        WorkflowState.Failed => "Failed",
        WorkflowState.Cancelled => "Cancelled",
        _ => state.ToString()
    };

    private static string GetTechnicalStateName(WorkflowState state) => state switch
    {
        WorkflowState.Triggered => "Triggered",
        WorkflowState.Analyzing => "Analyzing Repository",
        WorkflowState.TicketUpdateGenerated => "Ticket Update Generated",
        WorkflowState.TicketUpdateUnderReview => "Ticket Update Under Review",
        WorkflowState.TicketUpdateRejected => "Ticket Update Rejected",
        WorkflowState.TicketUpdateApproved => "Ticket Update Approved",
        WorkflowState.TicketUpdatePosted => "Ticket Update Posted",
        WorkflowState.QuestionsPosted => "Questions Posted",
        WorkflowState.AwaitingAnswers => "Awaiting Answers",
        WorkflowState.AnswersReceived => "Answers Received",
        WorkflowState.Planning => "Planning",
        WorkflowState.PlanPosted => "Plan Posted",
        WorkflowState.PlanUnderReview => "Plan Under Review",
        WorkflowState.PlanApproved => "Plan Approved",
        WorkflowState.PlanRejected => "Plan Rejected",
        WorkflowState.Implementing => "Implementing",
        WorkflowState.ImplementationFailed => "Implementation Failed",
        WorkflowState.PRCreated => "PR Created",
        WorkflowState.InReview => "In Review",
        WorkflowState.Completed => "Completed",
        WorkflowState.Failed => "Failed",
        WorkflowState.Cancelled => "Cancelled",
        _ => state.ToString()
    };

    private string BadgeClass => $"badge {GetBadgeColor()}";

    private string GetBadgeColor() => State switch
    {
        WorkflowState.Completed => "bg-success",
        WorkflowState.Failed or WorkflowState.ImplementationFailed => "bg-danger",
        WorkflowState.Cancelled => "bg-secondary",
        WorkflowState.AwaitingAnswers or WorkflowState.PlanUnderReview or WorkflowState.InReview or WorkflowState.TicketUpdateUnderReview => "bg-warning",
        WorkflowState.PRCreated => "bg-info",
        WorkflowState.Triggered => "bg-secondary",
        WorkflowState.PlanRejected or WorkflowState.TicketUpdateRejected => "bg-danger",
        WorkflowState.PlanApproved or WorkflowState.TicketUpdateApproved => "bg-success",
        _ => "bg-primary"
    };
}
