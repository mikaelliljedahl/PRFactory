@using System.Linq.Expressions

<div class="mb-3 form-check">
    <input
        type="checkbox"
        id="@FieldId"
        class="form-check-input @(IsInvalid ? "is-invalid" : "")"
        checked="@Value"
        @onchange="OnCheckChanged"
        disabled="@Disabled"
        required="@Required" />

    <label for="@FieldId" class="form-check-label">
        @Label
        @if (Required)
        {
            <span class="text-danger">*</span>
        }
    </label>

    @if (For != null)
    {
        <ValidationMessage For="@For" />
    }

    @if (!string.IsNullOrEmpty(HelpText))
    {
        <small class="form-text text-muted d-block">@HelpText</small>
    }
</div>

@code {
    [Parameter, EditorRequired]
    public string Label { get; set; } = null!;

    [Parameter]
    public string? Id { get; set; }

    [Parameter]
    public bool Value { get; set; }

    [Parameter]
    public EventCallback<bool> ValueChanged { get; set; }

    [Parameter]
    public bool Required { get; set; }

    [Parameter]
    public string? HelpText { get; set; }

    [Parameter]
    public bool Disabled { get; set; }

    [Parameter]
    public Expression<Func<bool>>? For { get; set; }

    [Parameter]
    public bool IsInvalid { get; set; }

    private string FieldId => Id ?? $"field-{Label.Replace(" ", "-").ToLower()}";

    private async Task OnCheckChanged(ChangeEventArgs e)
    {
        Value = e.Value is bool boolValue && boolValue;
        await ValueChanged.InvokeAsync(Value);
    }
}
